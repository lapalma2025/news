<!DOCTYPE html>
<html lang="pl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>InfoApp - Panel Administracyjny</title>
		<link
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
			rel="stylesheet"
		/>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/supabase/2.38.0/supabase.min.js"></script>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				color: #333;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}

			.header {
				background: rgba(255, 255, 255, 0.1);
				backdrop-filter: blur(10px);
				border-radius: 20px;
				padding: 30px;
				text-align: center;
				margin-bottom: 30px;
				border: 1px solid rgba(255, 255, 255, 0.2);
			}

			.header h1 {
				color: white;
				font-size: 2.5rem;
				margin-bottom: 10px;
				font-weight: 700;
			}

			.header p {
				color: rgba(255, 255, 255, 0.9);
				font-size: 1.1rem;
			}

			.admin-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
				gap: 30px;
				margin-bottom: 30px;
			}

			.admin-card {
				background: rgba(255, 255, 255, 0.95);
				backdrop-filter: blur(10px);
				border-radius: 20px;
				padding: 30px;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				transition: transform 0.3s ease, box-shadow 0.3s ease;
			}

			.admin-card:hover {
				transform: translateY(-5px);
				box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
			}

			.card-header {
				display: flex;
				align-items: center;
				margin-bottom: 25px;
			}

			.card-icon {
				width: 50px;
				height: 50px;
				background: linear-gradient(135deg, #667eea, #764ba2);
				border-radius: 15px;
				display: flex;
				align-items: center;
				justify-content: center;
				margin-right: 15px;
			}

			.card-icon i {
				color: white;
				font-size: 1.5rem;
			}

			.card-title {
				font-size: 1.5rem;
				font-weight: 700;
				color: #333;
			}

			.form-group {
				margin-bottom: 20px;
			}

			.form-label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
				color: #555;
				font-size: 0.95rem;
			}

			.form-input,
			.form-textarea,
			.form-select {
				width: 100%;
				padding: 12px 16px;
				border: 2px solid #e1e8f4;
				border-radius: 12px;
				font-size: 1rem;
				transition: all 0.3s ease;
				background: white;
			}

			.form-input:focus,
			.form-textarea:focus,
			.form-select:focus {
				outline: none;
				border-color: #667eea;
				box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
			}

			.form-textarea {
				min-height: 120px;
				resize: vertical;
				font-family: inherit;
			}

			.btn {
				background: linear-gradient(135deg, #667eea, #764ba2);
				color: white;
				border: none;
				padding: 14px 28px;
				border-radius: 12px;
				font-size: 1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				display: inline-flex;
				align-items: center;
				gap: 8px;
				text-decoration: none;
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
			}

			.btn:active {
				transform: translateY(0);
			}

			.btn-full {
				width: 100%;
				justify-content: center;
			}

			.stats-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 20px;
				margin-bottom: 30px;
			}

			.stat-card {
				background: rgba(255, 255, 255, 0.9);
				backdrop-filter: blur(10px);
				border-radius: 16px;
				padding: 25px;
				text-align: center;
				border: 1px solid rgba(255, 255, 255, 0.2);
				transition: transform 0.3s ease;
			}

			.stat-card:hover {
				transform: translateY(-3px);
			}

			.stat-number {
				font-size: 2.5rem;
				font-weight: 700;
				color: #667eea;
				margin-bottom: 8px;
			}

			.stat-label {
				color: #666;
				font-weight: 600;
			}

			.success-message,
			.error-message {
				padding: 12px 20px;
				border-radius: 8px;
				margin-bottom: 20px;
				font-weight: 500;
			}

			.success-message {
				background: #d1fae5;
				color: #065f46;
				border: 1px solid #a7f3d0;
			}

			.error-message {
				background: #fee2e2;
				color: #991b1b;
				border: 1px solid #fca5a5;
			}

			.recent-posts {
				background: rgba(255, 255, 255, 0.95);
				backdrop-filter: blur(10px);
				border-radius: 20px;
				padding: 30px;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
			}

			.post-item {
				padding: 15px;
				border-bottom: 1px solid #e5e7eb;
				display: flex;
				justify-content: space-between;
				align-items: flex-start;
			}

			.post-item:last-child {
				border-bottom: none;
			}

			.post-content h4 {
				color: #333;
				margin-bottom: 5px;
				font-size: 1.1rem;
			}

			.post-meta {
				color: #666;
				font-size: 0.9rem;
			}

			.post-stats {
				display: flex;
				gap: 15px;
				color: #666;
				font-size: 0.9rem;
			}

			.loading {
				text-align: center;
				padding: 40px;
				color: #666;
				font-size: 1.1rem;
			}

			@media (max-width: 768px) {
				.admin-grid {
					grid-template-columns: 1fr;
				}

				.container {
					padding: 15px;
				}

				.header h1 {
					font-size: 2rem;
				}

				.admin-card {
					padding: 20px;
				}
			}

			.connection-status {
				position: fixed;
				top: 20px;
				right: 20px;
				padding: 10px 15px;
				border-radius: 25px;
				font-size: 0.9rem;
				font-weight: 600;
				z-index: 1000;
				backdrop-filter: blur(10px);
			}

			.connected {
				background: rgba(16, 185, 129, 0.9);
				color: white;
			}

			.disconnected {
				background: rgba(239, 68, 68, 0.9);
				color: white;
			}
		</style>
	</head>
	<body>
		<div class="connection-status" id="connectionStatus">
			<i class="fas fa-circle"></i> Łączenie...
		</div>

		<div class="container">
			<div class="header">
				<h1><i class="fas fa-crown"></i> InfoApp Admin Panel</h1>
				<p>Zarządzaj newsami i komunikatami polityków w czasie rzeczywistym</p>
			</div>

			<!-- Statystyki -->
			<div class="stats-grid">
				<div class="stat-card">
					<div class="stat-number" id="newsCount">-</div>
					<div class="stat-label">Opublikowane Newsy</div>
				</div>
				<div class="stat-card">
					<div class="stat-number" id="politiciansCount">-</div>
					<div class="stat-label">Aktywni Politycy</div>
				</div>
				<div class="stat-card">
					<div class="stat-number" id="postsCount">-</div>
					<div class="stat-label">Wpisy Polityków</div>
				</div>
				<div class="stat-card">
					<div class="stat-number" id="totalEngagement">-</div>
					<div class="stat-label">Łączne Zaangażowanie</div>
				</div>
			</div>

			<div class="admin-grid">
				<!-- Dodawanie Newsów -->
				<div class="admin-card">
					<div class="card-header">
						<div class="card-icon">
							<i class="fas fa-newspaper"></i>
						</div>
						<h2 class="card-title">Dodaj News</h2>
					</div>

					<form id="newsForm">
						<div class="form-group">
							<label class="form-label" for="newsTitle">Tytuł newsa *</label>
							<input
								type="text"
								id="newsTitle"
								class="form-input"
								required
								placeholder="Wprowadź tytuł newsa..."
							/>
						</div>

						<div class="form-group">
							<label class="form-label" for="newsCategory">Kategoria *</label>
							<select id="newsCategory" class="form-select" required>
								<option value="">Wybierz kategorię</option>
								<option value="Polityka">Polityka</option>
								<option value="Ekonomia">Ekonomia</option>
								<option value="Technologia">Technologia</option>
								<option value="Społeczeństwo">Społeczeństwo</option>
								<option value="Kultura">Kultura</option>
								<option value="Sport">Sport</option>
								<option value="Inne">Inne</option>
							</select>
						</div>

						<div class="form-group">
							<label class="form-label" for="newsAuthor">Autor *</label>
							<input
								type="text"
								id="newsAuthor"
								class="form-input"
								required
								placeholder="Imię i nazwisko autora"
							/>
						</div>

						<div class="form-group">
							<label class="form-label" for="newsContent">Treść newsa *</label>
							<textarea
								id="newsContent"
								class="form-textarea"
								required
								placeholder="Wprowadź pełną treść newsa..."
							></textarea>
						</div>

						<button type="submit" class="btn btn-full">
							<i class="fas fa-plus"></i>
							Opublikuj News
						</button>
					</form>

					<div id="newsMessage"></div>
				</div>

				<!-- Zarządzanie Politykami -->
				<div class="admin-card">
					<div class="card-header">
						<div class="card-icon">
							<i class="fas fa-users"></i>
						</div>
						<h2 class="card-title">Dodaj Polityka</h2>
					</div>

					<form id="politicianForm">
						<div class="form-group">
							<label class="form-label" for="politicianName"
								>Imię i Nazwisko *</label
							>
							<input
								type="text"
								id="politicianName"
								class="form-input"
								required
								placeholder="Jan Kowalski"
							/>
						</div>

						<div class="form-group">
							<label class="form-label" for="politicianParty">Partia *</label>
							<input
								type="text"
								id="politicianParty"
								class="form-input"
								required
								placeholder="Nazwa partii"
							/>
						</div>

						<div class="form-group">
							<label class="form-label" for="politicianPhoto"
								>URL Zdjęcia</label
							>
							<input
								type="url"
								id="politicianPhoto"
								class="form-input"
								placeholder="https://example.com/photo.jpg"
							/>
						</div>

						<button type="submit" class="btn btn-full">
							<i class="fas fa-user-plus"></i>
							Dodaj Polityka
						</button>
					</form>

					<div id="politicianMessage"></div>

					<!-- Lista polityków -->
					<div style="margin-top: 30px">
						<h3 style="margin-bottom: 15px; color: #333">
							Dodaj Wpis Polityka
						</h3>

						<form id="politicianPostForm">
							<div class="form-group">
								<label class="form-label" for="selectedPolitician"
									>Wybierz Polityka *</label
								>
								<select id="selectedPolitician" class="form-select" required>
									<option value="">Ładowanie polityków...</option>
								</select>
							</div>

							<div class="form-group">
								<label class="form-label" for="postTitle">Tytuł wpisu *</label>
								<input
									type="text"
									id="postTitle"
									class="form-input"
									required
									placeholder="Tytuł komunikatu polityka"
								/>
							</div>

							<div class="form-group">
								<label class="form-label" for="postContent"
									>Treść wpisu *</label
								>
								<textarea
									id="postContent"
									class="form-textarea"
									required
									placeholder="Treść komunikatu polityka..."
								></textarea>
							</div>

							<button type="submit" class="btn btn-full">
								<i class="fas fa-megaphone"></i>
								Opublikuj Wpis
							</button>
						</form>

						<div id="postMessage"></div>
					</div>
				</div>
			</div>

			<!-- Ostatnie wpisy -->
			<div class="recent-posts">
				<div class="card-header">
					<div class="card-icon">
						<i class="fas fa-clock"></i>
					</div>
					<h2 class="card-title">Ostatnie Publikacje</h2>
				</div>
				<div id="recentPosts" class="loading">
					Ładowanie ostatnich wpisów...
				</div>
			</div>
		</div>

		<script>
			// Konfiguracja Supabase - ZASTĄP SWOIMI DANYMI
			const SUPABASE_URL = "https://twoja-instancja.supabase.co";
			const SUPABASE_ANON_KEY = "twoj-anon-key";

			const supabaseClient = supabase.createClient(
				SUPABASE_URL,
				SUPABASE_ANON_KEY
			);

			// Sprawdzenie połączenia
			async function checkConnection() {
				const statusEl = document.getElementById("connectionStatus");
				try {
					const { data, error } = await supabaseClient
						.from("infoapp_news")
						.select("id")
						.limit(1);
					if (error) throw error;

					statusEl.innerHTML = '<i class="fas fa-check-circle"></i> Połączono';
					statusEl.className = "connection-status connected";
				} catch (error) {
					statusEl.innerHTML =
						'<i class="fas fa-exclamation-triangle"></i> Błąd połączenia';
					statusEl.className = "connection-status disconnected";
					console.error("Connection error:", error);
				}
			}

			// Ładowanie statystyk
			async function loadStats() {
				try {
					const [newsResult, politiciansResult, postsResult] =
						await Promise.all([
							supabaseClient
								.from("infoapp_news")
								.select("id, likes_count, comments_count")
								.eq("is_active", true),
							supabaseClient
								.from("infoapp_politicians")
								.select("id")
								.eq("is_active", true),
							supabaseClient
								.from("politician_posts")
								.select("id, likes_count, comments_count")
								.eq("is_active", true),
						]);

					const newsCount = newsResult.data?.length || 0;
					const politiciansCount = politiciansResult.data?.length || 0;
					const postsCount = postsResult.data?.length || 0;

					const totalEngagement =
						(newsResult.data || []).reduce(
							(sum, item) =>
								sum + (item.likes_count || 0) + (item.comments_count || 0),
							0
						) +
						(postsResult.data || []).reduce(
							(sum, item) =>
								sum + (item.likes_count || 0) + (item.comments_count || 0),
							0
						);

					document.getElementById("newsCount").textContent = newsCount;
					document.getElementById("politiciansCount").textContent =
						politiciansCount;
					document.getElementById("postsCount").textContent = postsCount;
					document.getElementById("totalEngagement").textContent =
						totalEngagement;
				} catch (error) {
					console.error("Error loading stats:", error);
				}
			}

			// Ładowanie polityków do selecta
			async function loadPoliticians() {
				try {
					const { data, error } = await supabaseClient
						.from("infoapp_politicians")
						.select("*")
						.eq("is_active", true)
						.order("name");

					if (error) throw error;

					const select = document.getElementById("selectedPolitician");
					select.innerHTML = '<option value="">Wybierz polityka</option>';

					data.forEach((politician) => {
						const option = document.createElement("option");
						option.value = politician.id;
						option.textContent = `${politician.name} (${politician.party})`;
						select.appendChild(option);
					});
				} catch (error) {
					console.error("Error loading politicians:", error);
					document.getElementById("selectedPolitician").innerHTML =
						'<option value="">Błąd ładowania polityków</option>';
				}
			}

			// Ładowanie ostatnich wpisów
			async function loadRecentPosts() {
				try {
					const [newsResult, postsResult] = await Promise.all([
						supabaseClient
							.from("infoapp_news")
							.select("*")
							.eq("is_active", true)
							.order("created_at", { ascending: false })
							.limit(5),
						supabaseClient
							.from("politician_posts")
							.select(
								`
                        *,
                        politicians (name, party)
                    `
							)
							.eq("is_active", true)
							.order("created_at", { ascending: false })
							.limit(5),
					]);

					const container = document.getElementById("recentPosts");
					container.innerHTML = "";

					// Dodaj newsy
					if (newsResult.data && newsResult.data.length > 0) {
						newsResult.data.forEach((news) => {
							const item = createPostItem(news, "news");
							container.appendChild(item);
						});
					}

					// Dodaj wpisy polityków
					if (postsResult.data && postsResult.data.length > 0) {
						postsResult.data.forEach((post) => {
							const item = createPostItem(post, "politician");
							container.appendChild(item);
						});
					}

					if (container.children.length === 0) {
						container.innerHTML =
							'<div class="loading">Brak wpisów do wyświetlenia</div>';
					}
				} catch (error) {
					console.error("Error loading recent posts:", error);
					document.getElementById("recentPosts").innerHTML =
						'<div class="loading">Błąd ładowania wpisów</div>';
				}
			}

			// Tworzenie elementu wpisu
			function createPostItem(post, type) {
				const div = document.createElement("div");
				div.className = "post-item";

				const authorName =
					type === "news"
						? post.author
						: post.politicians
						? `${post.politicians.name} (${post.politicians.party})`
						: "Nieznany polityk";

				const typeLabel = type === "news" ? "News" : "Wpis polityka";
				const timeAgo = new Date(post.created_at).toLocaleString("pl-PL");

				div.innerHTML = `
                <div class="post-content">
                    <h4>${post.title}</h4>
                    <div class="post-meta">
                        ${typeLabel} • ${authorName} • ${timeAgo}
                    </div>
                </div>
                <div class="post-stats">
                    <span><i class="fas fa-heart"></i> ${
											post.likes_count || 0
										}</span>
                    <span><i class="fas fa-comment"></i> ${
											post.comments_count || 0
										}</span>
                </div>
            `;

				return div;
			}

			// Obsługa formularzy
			document
				.getElementById("newsForm")
				.addEventListener("submit", async (e) => {
					e.preventDefault();

					const messageEl = document.getElementById("newsMessage");
					const submitBtn = e.target.querySelector('button[type="submit"]');

					try {
						submitBtn.disabled = true;
						submitBtn.innerHTML =
							'<i class="fas fa-spinner fa-spin"></i> Publikowanie...';

						const newsData = {
							title: document.getElementById("newsTitle").value,
							content: document.getElementById("newsContent").value,
							author: document.getElementById("newsAuthor").value,
							category: document.getElementById("newsCategory").value,
							created_at: new Date().toISOString(),
							updated_at: new Date().toISOString(),
							likes_count: 0,
							comments_count: 0,
							is_active: true,
						};

						const { data, error } = await supabaseClient
							.from("infoapp_news")
							.insert([newsData])
							.select();

						if (error) throw error;

						messageEl.innerHTML =
							'<div class="success-message">✅ News został pomyślnie opublikowany!</div>';
						e.target.reset();
						loadStats();
						loadRecentPosts();

						setTimeout(() => {
							messageEl.innerHTML = "";
						}, 5000);
					} catch (error) {
						console.error("Error adding news:", error);
						messageEl.innerHTML = `<div class="error-message">❌ Błąd: ${error.message}</div>`;
					} finally {
						submitBtn.disabled = false;
						submitBtn.innerHTML = '<i class="fas fa-plus"></i> Opublikuj News';
					}
				});

			document
				.getElementById("politicianForm")
				.addEventListener("submit", async (e) => {
					e.preventDefault();

					const messageEl = document.getElementById("politicianMessage");
					const submitBtn = e.target.querySelector('button[type="submit"]');

					try {
						submitBtn.disabled = true;
						submitBtn.innerHTML =
							'<i class="fas fa-spinner fa-spin"></i> Dodawanie...';

						const politicianData = {
							name: document.getElementById("politicianName").value,
							party: document.getElementById("politicianParty").value,
							photo_url:
								document.getElementById("politicianPhoto").value || null,
							created_at: new Date().toISOString(),
							is_active: true,
						};

						const { data, error } = await supabaseClient
							.from("infoapp_politicians")
							.insert([politicianData])
							.select();

						if (error) throw error;

						messageEl.innerHTML =
							'<div class="success-message">✅ Polityk został pomyślnie dodany!</div>';
						e.target.reset();
						loadStats();
						loadPoliticians();

						setTimeout(() => {
							messageEl.innerHTML = "";
						}, 5000);
					} catch (error) {
						console.error("Error adding politician:", error);
						messageEl.innerHTML = `<div class="error-message">❌ Błąd: ${error.message}</div>`;
					} finally {
						submitBtn.disabled = false;
						submitBtn.innerHTML =
							'<i class="fas fa-user-plus"></i> Dodaj Polityka';
					}
				});

			document
				.getElementById("politicianPostForm")
				.addEventListener("submit", async (e) => {
					e.preventDefault();

					const messageEl = document.getElementById("postMessage");
					const submitBtn = e.target.querySelector('button[type="submit"]');

					try {
						submitBtn.disabled = true;
						submitBtn.innerHTML =
							'<i class="fas fa-spinner fa-spin"></i> Publikowanie...';

						const postData = {
							politician_id:
								document.getElementById("selectedPolitician").value,
							title: document.getElementById("postTitle").value,
							content: document.getElementById("postContent").value,
							created_at: new Date().toISOString(),
							updated_at: new Date().toISOString(),
							likes_count: 0,
							comments_count: 0,
							is_active: true,
						};

						const { data, error } = await supabaseClient
							.from("politician_posts")
							.insert([postData])
							.select();

						if (error) throw error;

						messageEl.innerHTML =
							'<div class="success-message">✅ Wpis polityka został pomyślnie opublikowany!</div>';
						e.target.reset();
						loadStats();
						loadRecentPosts();

						setTimeout(() => {
							messageEl.innerHTML = "";
						}, 5000);
					} catch (error) {
						console.error("Error adding politician post:", error);
						messageEl.innerHTML = `<div class="error-message">❌ Błąd: ${error.message}</div>`;
					} finally {
						submitBtn.disabled = false;
						submitBtn.innerHTML =
							'<i class="fas fa-megaphone"></i> Opublikuj Wpis';
					}
				});

			// Inicjalizacja
			document.addEventListener("DOMContentLoaded", () => {
				checkConnection();
				loadStats();
				loadPoliticians();
				loadRecentPosts();

				// Odświeżanie co 30 sekund
				setInterval(() => {
					loadStats();
					loadRecentPosts();
				}, 30000);
			});
		</script>
	</body>
</html>
